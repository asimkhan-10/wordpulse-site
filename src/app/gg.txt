"use client";

import React, { useState, useMemo, useEffect, useRef } from 'react';
import { 
  Search, Check, X, Zap, Star, Info, Hash, 
  ChevronDown, Trash2, Copy, BookOpen, 
  Lightbulb, HelpCircle, Trophy, Keyboard, RotateCcw,
  Target, Sparkles, ShieldCheck, ZapOff
} from 'lucide-react';

/**
 * WordPulse: Professional Wordle Solver
 * Balanced UI Scaling: Optimized for visual density and focus.
 * Expanded SEO Content Layer.
 */
import wordDataImport from '@/app/data/words.json';

const wordData = wordDataImport || { allWords: [], commonWords: [] };

export default function WordPulse() {
  const [knownPos, setKnownPos] = useState(["", "", "", "", ""]);
  const [includeLetters, setIncludeLetters] = useState("");
  const [excludeLetters, setExcludeLetters] = useState("");
  const [searchTerm, setSearchTerm] = useState("");
  const [commonOnly, setCommonOnly] = useState(true);
  const [copiedWord, setCopiedWord] = useState(null);
  const [displayLimit, setDisplayLimit] = useState(30);
  const [isScrolled, setIsScrolled] = useState(false);

  // Refs for auto-focusing
  const inputRefs = [useRef(), useRef(), useRef(), useRef(), useRef()];

  const alphabet = "abcdefghijklmnopqrstuvwxyz".split("");
  const allWords = wordData?.allWords || [];
  const commonWords = wordData?.commonWords || [];

  // Scroll detection for navbar
  useEffect(() => {
    const handleScroll = () => setIsScrolled(window.scrollY > 20);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  // Filter Logic
  const filteredWords = useMemo(() => {
    const source = commonOnly ? commonWords : allWords;
    if (!source) return [];

    return source.filter(word => {
      const w = word.toLowerCase();
      for (let i = 0; i < 5; i++) {
        if (knownPos[i] && w[i] !== knownPos[i].toLowerCase()) return false;
      }
      if (includeLetters) {
        const letters = includeLetters.toLowerCase().split(/[\s,]+/).filter(Boolean);
        if (!letters.every(char => w.includes(char))) return false;
      }
      if (excludeLetters) {
        const letters = excludeLetters.toLowerCase().split(/[\s,]+/).filter(Boolean);
        if (letters.some(char => w.includes(char))) return false;
      }
      if (searchTerm && !w.includes(searchTerm.toLowerCase())) return false;
      return true;
    });
  }, [knownPos, includeLetters, excludeLetters, searchTerm, commonOnly, allWords, commonWords]);

  // Handlers
  const handleGridChange = (index, value) => {
    const newPos = [...knownPos];
    const char = value.replace(/[^a-zA-Z]/g, '').slice(-1).toUpperCase();
    newPos[index] = char;
    setKnownPos(newPos);
    if (char && index < 4) {
      inputRefs[index + 1].current?.focus();
    }
  };

  const handleKeyDown = (index, e) => {
    if (e.key === 'Backspace' && !knownPos[index] && index > 0) {
      inputRefs[index - 1].current?.focus();
    }
  };

  const copyToClipboard = (word) => {
    if (typeof navigator !== 'undefined') {
      navigator.clipboard.writeText(word);
      setCopiedWord(word);
      setTimeout(() => setCopiedWord(null), 1500);
    }
  };

  const resetAll = () => {
    setKnownPos(["", "", "", "", ""]);
    setIncludeLetters("");
    setExcludeLetters("");
    setSearchTerm("");
  };

  return (
    <div className="min-h-screen bg-[#02040a] text-slate-300 font-sans antialiased selection:bg-emerald-500/30">
      {/* Navigation */}
      <nav className={`fixed top-0 w-full z-[100] transition-all duration-300 ${isScrolled ? 'bg-[#0a0f18]/90 backdrop-blur-md border-b border-white/5 py-2' : 'bg-transparent py-4'}`}>
        <div className="max-w-7xl mx-auto px-6 flex items-center justify-between">
          <div className="flex items-center gap-3 group cursor-pointer">
            <div className="relative">
              <div className="absolute inset-0 bg-emerald-500 blur-lg opacity-20 group-hover:opacity-40 transition-opacity" />
              <div className="relative p-1.5 bg-gradient-to-tr from-emerald-500 to-teal-400 rounded-lg shadow-lg">
                <Keyboard size={16} className="text-[#02040a]" />
              </div>
            </div>
            <h1 className="text-lg font-bold text-white tracking-tight italic uppercase">WordPulse<span className="text-emerald-500">.</span></h1>
          </div>
          <div className="hidden md:flex items-center gap-6">
            <span className="text-[10px] font-semibold text-slate-500 uppercase tracking-widest bg-white/5 px-3 py-1 rounded-full border border-white/10">
              {allWords.length.toLocaleString()} Words Indexed
            </span>
          </div>
        </div>
      </nav>

      <main className="pt-24 pb-16 px-4 md:px-6 max-w-7xl mx-auto relative">
        {/* Background Decor */}
        <div className="absolute top-10 left-1/2 -translate-x-1/2 w-full h-[400px] bg-emerald-500/5 blur-[100px] rounded-full pointer-events-none -z-10" />

        <div className="text-center mb-10 max-w-2xl mx-auto">
          <h2 className="text-3xl md:text-5xl font-black text-white mb-4 tracking-tighter uppercase italic">
            Professional <span className="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-300">Solver</span>
          </h2>
          <p className="text-slate-400 text-base leading-relaxed">
            Harness the power of pattern matching. Solve Wordle and crosswords with studio-grade precision.
          </p>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
          {/* Sidebar / Filters */}
          <aside className="lg:col-span-4 space-y-5 lg:sticky lg:top-20">
            <div className="bg-[#0a0f18] border border-white/10 rounded-3xl p-6 shadow-xl relative overflow-hidden group">
              <div className="absolute -right-20 -top-20 w-64 h-64 bg-emerald-500/5 blur-[100px] rounded-full pointer-events-none" />
              
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-2">
                  <Hash size={14} className="text-emerald-500" />
                  <h3 className="text-[10px] font-black text-white uppercase tracking-[0.2em]">Filter Engine</h3>
                </div>
                <button onClick={resetAll} className="p-1.5 text-slate-600 hover:text-red-400 hover:bg-red-400/10 rounded-lg transition-all">
                  <RotateCcw size={14} />
                </button>
              </div>

              {/* Grid System */}
              <div className="space-y-3 mb-8">
                <div className="flex items-center justify-between px-1">
                   <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Locked Positions</label>
                   <Info size={12} className="text-slate-700 cursor-help" />
                </div>
                <div className="grid grid-cols-5 gap-2">
                  {knownPos.map((val, i) => (
                    <input
                      key={i}
                      ref={inputRefs[i]}
                      type="text"
                      maxLength={1}
                      autoComplete="off"
                      value={val}
                      onKeyDown={(e) => handleKeyDown(i, e)}
                      onChange={(e) => handleGridChange(i, e.target.value)}
                      className={`aspect-square text-center text-xl font-black rounded-xl border-2 transition-all outline-none shadow-inner
                        ${val ? 'bg-emerald-500/10 border-emerald-500 text-emerald-400 shadow-[0_0_15px_rgba(16,185,129,0.15)]' : 'bg-[#02040a] border-white/5 text-white focus:border-emerald-500/40'}`}
                      placeholder={(i+1).toString()}
                    />
                  ))}
                </div>
              </div>

              {/* Text Fields */}
              <div className="space-y-5">
                <div className="space-y-2">
                  <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">Must Include</label>
                  <input type="text" value={includeLetters} onChange={(e) => setIncludeLetters(e.target.value)} placeholder="Letters in any spot" className="w-full bg-[#02040a] border border-white/5 rounded-xl p-3 text-sm outline-none focus:border-emerald-500/30 text-white placeholder:text-slate-800 transition-all shadow-inner" />
                </div>
                <div className="space-y-2">
                  <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">Must Exclude</label>
                  <input type="text" value={excludeLetters} onChange={(e) => setExcludeLetters(e.target.value)} placeholder="Letters not in word" className="w-full bg-[#02040a] border border-white/5 rounded-xl p-3 text-sm outline-none focus:border-red-900/30 text-white placeholder:text-slate-800 transition-all shadow-inner" />
                </div>
              </div>

              {/* Toggle */}
              <div className="mt-8 pt-6 border-t border-white/5">
                <button onClick={() => setCommonOnly(!commonOnly)} className="w-full flex items-center justify-between p-4 bg-white/[0.02] border border-white/5 rounded-xl hover:bg-white/[0.04] transition-all">
                  <div className="flex items-center gap-3">
                    <Star size={14} className={commonOnly ? "text-emerald-400 fill-emerald-400" : "text-slate-700"} />
                    <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Common Only</span>
                  </div>
                  <div className={`w-8 h-4 rounded-full relative transition-colors ${commonOnly ? 'bg-emerald-500' : 'bg-slate-800'}`}>
                    <div className={`absolute top-0.5 w-3 h-3 bg-white rounded-full transition-all ${commonOnly ? 'left-4.5' : 'left-0.5'}`} />
                  </div>
                </button>
              </div>
            </div>
            
            <div className="bg-gradient-to-br from-emerald-500/10 to-teal-500/5 border border-emerald-500/20 rounded-3xl p-5 text-center shadow-lg">
               <Trophy className="mx-auto mb-2 text-emerald-500" size={18} />
               <p className="text-[10px] font-black text-emerald-400 uppercase tracking-[0.2em]">Precision Engine</p>
               <p className="text-[10px] text-slate-500 mt-1.5 leading-relaxed">Dictionary optimized for solution sets and common patterns.</p>
            </div>
          </aside>

          {/* Main Results Column */}
          <section className="lg:col-span-8 space-y-6">
            <div className="relative group">
              <Search className="absolute left-6 top-1/2 -translate-y-1/2 text-slate-700 group-focus-within:text-emerald-500 transition-colors" size={20} />
              <input type="text" placeholder="Live unscramble matching patterns..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full bg-[#0a0f18] border border-white/10 rounded-2xl py-5 pl-14 pr-6 outline-none focus:border-emerald-500/50 text-xl font-medium text-white shadow-xl transition-all placeholder:text-slate-900" />
            </div>
            
            <div className="bg-[#0a0f18] border border-white/10 rounded-[2rem] p-6 md:p-8 min-h-[550px] shadow-2xl relative overflow-hidden backdrop-blur-sm">
              <div className="flex items-center justify-between mb-8 pb-4 border-b border-white/5">
                <div className="flex flex-col gap-1">
                  <h4 className="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] italic">
                    {filteredWords.length} Suggestions Found
                  </h4>
                  {filteredWords.length > displayLimit && (
                    <span className="text-[9px] font-bold text-emerald-400/50 uppercase tracking-widest">
                      Showing top {displayLimit} results
                    </span>
                  )}
                </div>
                <div className="flex gap-1">
                   <div className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse" />
                   <div className="w-1.5 h-1.5 rounded-full bg-teal-500 animate-pulse delay-75" />
                </div>
              </div>
              
              {filteredWords.length > 0 ? (
                <>
                  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-3">
                    {filteredWords.slice(0, displayLimit).map(word => (
                      <button 
                        key={word} 
                        onClick={() => copyToClipboard(word)} 
                        className="group relative p-4 bg-white/[0.02] hover:bg-emerald-500/10 border border-white/5 hover:border-emerald-500/50 rounded-xl transition-all duration-300 overflow-hidden text-center shadow-md active:scale-95"
                      >
                        <span className="font-mono text-lg font-black uppercase tracking-[0.2em] text-slate-400 group-hover:text-white transition-colors">
                          {word}
                        </span>
                        <div className={`absolute inset-0 flex items-center justify-center bg-emerald-500 text-[#02040a] transition-all duration-300 ${copiedWord === word ? 'translate-y-0' : 'translate-y-full'}`}>
                          <Check size={20} strokeWidth={3} />
                        </div>
                      </button>
                    ))}
                  </div>

                  {filteredWords.length > displayLimit && (
                    <div className="mt-12 flex justify-center pb-6">
                      <button onClick={() => setDisplayLimit(prev => prev + 100)} className="px-8 py-4 bg-white/5 border border-white/10 hover:border-emerald-500/50 rounded-xl text-[10px] font-black text-slate-500 hover:text-white uppercase tracking-[0.3em] transition-all flex items-center gap-3 group shadow-lg">
                        Load More Words <ChevronDown size={14} className="group-hover:translate-y-0.5 transition-transform" />
                      </button>
                    </div>
                  )}
                </>
              ) : (
                <div className="flex flex-col items-center justify-center py-40 opacity-10">
                  <BookOpen size={48} className="mb-4" />
                  <p className="font-black uppercase tracking-[0.4em] text-xs text-center italic">No patterns detected</p>
                </div>
              )}
            </div>

            <div className="mt-8 bg-white/[0.02] border border-white/5 rounded-2xl p-6">
              <p className="text-[10px] font-black text-slate-700 uppercase tracking-[0.5em] mb-6 text-center md:text-left italic">Dictionary Index Jump</p>
              <div className="flex flex-wrap gap-2">
                {alphabet.map((char) => (
                  <button key={char} onClick={() => setSearchTerm(char)} className="w-9 h-9 flex items-center justify-center rounded-lg bg-white/5 border border-white/10 text-[10px] font-black text-slate-600 hover:border-emerald-500/50 hover:text-white hover:bg-emerald-500/5 transition-all uppercase">
                    {char}
                  </button>
                ))}
              </div>
            </div>
          </section>
        </div>

        {/* --- EXPANDED SEO CONTENT SECTION --- */}
        <article className="mt-20 border-t border-white/5 pt-16 max-w-5xl mx-auto select-none">
          <header className="mb-14 text-center">
            <h2 className="text-2xl md:text-4xl font-black text-white mb-6 tracking-tighter uppercase italic">
              Advanced <span className="text-emerald-500">5-Letter</span> Word Search & Discovery
            </h2>
            <p className="text-slate-500 leading-relaxed text-base font-medium max-w-3xl mx-auto">
              WordPulse is a high-performance search utility designed for word game enthusiasts and puzzle solvers. Our proprietary pattern-matching engine allows you to filter through a massive database of verified 5-letter words in real-time, helping you crack even the most difficult daily challenges.
            </p>
          </header>

          <div className="grid md:grid-cols-3 gap-6 mb-20">
            <div className="p-8 bg-white/[0.02] border border-white/5 rounded-3xl space-y-4 hover:border-emerald-500/20 transition-all">
              <div className="flex items-center gap-3 text-emerald-400">
                <Target size={22} />
                <h3 className="text-sm font-black text-white uppercase tracking-wider">Exact Matching</h3>
              </div>
              <p className="text-slate-500 text-[13px] leading-relaxed font-medium">
                Lock letters into their correct positions using our 5-box grid. This feature is essential for games like Wordle where knowing the exact spot of a character is the key to winning.
              </p>
            </div>
            <div className="p-8 bg-white/[0.02] border border-white/5 rounded-3xl space-y-4 hover:border-teal-400/20 transition-all">
              <div className="flex items-center gap-3 text-teal-400">
                <Sparkles size={22} />
                <h3 className="text-sm font-black text-white uppercase tracking-wider">Smart Inclusion</h3>
              </div>
              <p className="text-slate-500 text-[13px] leading-relaxed font-medium">
                Unscramble words by specifying letters that must exist anywhere in the word. Our algorithm instantly prioritizes high-frequency results for faster discovery.
              </p>
            </div>
            <div className="p-8 bg-white/[0.02] border border-white/5 rounded-3xl space-y-4 hover:border-red-400/20 transition-all">
              <div className="flex items-center gap-3 text-red-400">
                <ZapOff size={22} />
                <h3 className="text-sm font-black text-white uppercase tracking-wider">Fast Exclusion</h3>
              </div>
              <p className="text-slate-500 text-[13px] leading-relaxed font-medium">
                Quickly eliminate words containing grayed-out letters. By narrowing down the search space, you increase your accuracy and preserve your win streak.
              </p>
            </div>
          </div>

          <div className="bg-[#0a0f18] border border-white/5 rounded-[3rem] p-10 md:p-16 mb-20 shadow-2xl relative overflow-hidden">
            <div className="absolute top-0 right-0 p-10 opacity-[0.03] pointer-events-none">
              <Zap size={200} />
            </div>
            <h2 className="text-2xl font-black text-white mb-8 uppercase tracking-widest italic">How to Solve Wordle Every Day</h2>
            <div className="prose prose-invert max-w-none text-slate-400 space-y-6">
              <p className="text-base leading-relaxed">
                Winning at daily word games is not just about luck—it's about information theory. Every guess you make should aim to eliminate as many letters as possible. This is why statistical analysis suggests starting with words like <strong>CRANE</strong>, <strong>ADIEU</strong>, or <strong>TRACE</strong>. These words contain high-frequency letters that appear most often in the English vocabulary.
              </p>
              <p className="text-base leading-relaxed">
                When you receive clues, input them into WordPulse. The green letters go into our "Locked Positions" grid, yellow letters go into "Must Include," and gray letters go into "Must Exclude." Our engine will process the thousands of possibilities in our database and present you with only the valid candidates.
              </p>
              <div className="flex flex-col md:flex-row gap-4 pt-4">
                <div className="flex items-center gap-2 px-4 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-full text-[11px] font-black text-emerald-400 uppercase tracking-widest">
                  <ShieldCheck size={14} /> Verified Solution List
                </div>
                <div className="flex items-center gap-2 px-4 py-2 bg-teal-500/10 border border-teal-500/20 rounded-full text-[11px] font-black text-teal-400 uppercase tracking-widest">
                  <Keyboard size={14} /> Mobile Optimized Input
                </div>
              </div>
            </div>
          </div>

          <section className="bg-gradient-to-br from-white/[0.02] to-transparent border border-white/5 rounded-[2rem] p-8 md:p-12 shadow-xl">
            <h2 className="text-xl font-black text-white mb-10 uppercase tracking-widest italic flex items-center gap-3">
              <HelpCircle size={22} className="text-emerald-500" /> Solver FAQ
            </h2>
            <div className="grid md:grid-cols-2 gap-12">
              <div className="space-y-10">
                <div className="group">
                  <h4 className="text-[13px] text-slate-200 font-black uppercase tracking-wider mb-3 group-hover:text-emerald-400 transition-colors underline decoration-emerald-500/30 underline-offset-4">
                    How many words are in the WordPulse dictionary?
                  </h4>
                  <p className="text-slate-500 text-[12px] leading-relaxed">
                    Our database contains over 12,000 verified five-letter English words. This includes the original Wordle solution set of ~2,300 common words plus a comprehensive dictionary of nearly 10,000 additional valid word game inputs.
                  </p>
                </div>
                <div className="group">
                  <h4 className="text-[13px] text-slate-200 font-black uppercase tracking-wider mb-3 group-hover:text-emerald-400 transition-colors underline decoration-emerald-500/30 underline-offset-4">
                    Is this tool updated for 2026?
                  </h4>
                  <p className="text-slate-500 text-[12px] leading-relaxed">
                    Yes. We constantly sync our data with the latest updates from major word games. We ensure that plurals, scientific terms, and modern slang are accurately categorized to provide you with the most relevant guesses.
                  </p>
                </div>
              </div>
              <div className="space-y-10">
                <div className="group">
                  <h4 className="text-[13px] text-slate-200 font-black uppercase tracking-wider mb-3 group-hover:text-emerald-400 transition-colors underline decoration-emerald-500/30 underline-offset-4">
                    Can I use WordPulse for other word games?
                  </h4>
                  <p className="text-slate-500 text-[12px] leading-relaxed">
                    Absolutely. While optimized for 5-letter word games, WordPulse is a powerful unscrambler and pattern matcher that works perfectly for Quordle, Octordle, Sedecordle, and crossword puzzles.
                  </p>
                </div>
                <div className="group">
                  <h4 className="text-[13px] text-slate-200 font-black uppercase tracking-wider mb-3 group-hover:text-emerald-400 transition-colors underline decoration-emerald-500/30 underline-offset-4">
                    Why use the "Common Only" toggle?
                  </h4>
                  <p className="text-slate-500 text-[12px] leading-relaxed">
                    The "Common Only" toggle filters out obscure words and archaic terms. This is highly recommended for Wordle players, as the game typically selects its daily word from a curated list of well-known English vocabulary.
                  </p>
                </div>
              </div>
            </div>
          </section>
        </article>
      </main>

      <footer className="py-12 border-t border-white/5 text-center bg-black/40">
        <div className="flex items-center justify-center gap-2 mb-4 opacity-30">
          <Zap size={12} className="text-emerald-500 fill-emerald-500" />
          <span className="text-[9px] font-black uppercase tracking-[0.5em] text-white">WordPulse Studio</span>
        </div>
        <p className="text-[8px] font-bold text-slate-700 uppercase tracking-[0.2em]">Designed for Performance • Built for Word Games • © 2026</p>
      </footer>
    </div>
  );
}